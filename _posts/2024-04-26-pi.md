---
title: Self-hosted server (raspberry pi)
#authors: ["LS Flores", "MH Vainstein", "HCM Fernandes", "MA Amaral"]
#journal: "Journal of Theoretical Biology 524, 110737"
date: 2024-04-26 11:33:00 +0800
categories: []
tags: [raspberrypi]
pin: true
math: true
mermaid: true
image:
  path: "/commons/pi.png"

---

The goal of this post is to show my Raspberry Pi setup. I use it mainly as a self-hosted server with Nextcloud to replace Google Drive. 

```
  Important: This setup does not need access to a router
```

The first thing is to intall raspberry OS 64bit lite on SSD (dont forget to enable ssh)
	
  ```
  Important: DONT USE BOOKWORM OS, USE BULLEYE. The former does not allow to
   config the wifi connection via the wpa_supplicant.conf in roots
```

## Wifi connection

Now on the SSD, inside the roots folder, create a file named wpa_supplicant.conf with 

```conf
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
#ctrl_interface=/run/wpa_supplicant
update_config=1
country=DE


#network={
#	ssid="hotspot"
#	scan_ssid=1
#	psk=",2945At0"
#	key_mgmt=WPA-PSK
#}

network={
	ssid="eduroam"
	key_mgmt=WPA-EAP
	eap=PEAP
	phase2="auth=MSCHAPV2"
	identity="username@ufrgs.br"
	password=""
}
```
  
## Pi 

With that the Pi is ready to boot, so connect the SSD on the Pi and try to ssh it.

		
		
	sudo apt update, upgrade
	install avahi daemon (ssh to localhost name)  (not needed i think)
	sudo apt install neofetch
	vcgencmd measure_temp
	
	docker compose (use debian setup)
	mkdir containers
		touch docker-compose.yml
			nextcloud
				path to files: sudo ls /var/lib/docker/volumes/containers_nextcloud/_data/data/lucasflores/files
			pi-hole (password:password) port/admin
				steveblack adlist, change in pihole
				update gravity
			ZeroTIer
				install ZeroTier in the other device
				approve then in zerotier website
	inside containers 
		sudo touch etc-dnsmasq.d/02-local-dns.conf 
			address=/.local/172.28.226.234   (zerotier ip) can use skynet.local:port instead of ip
	
	change DNS server assignment to manual and put Zerotier pi ip (now everything passes through pi)






## Docker Compose file

```yml
# run these
# docker compose pull && docker compose up -d
# commands inside container folder: docker compose exec folder_name command


version: "3.8"

# ----------------------
x-bb-common: &common
  networks:
    - internal
  restart: unless-stopped
#  deploy:
#    resources:
#      limits:
#        cpus: "3"
#        memory: 2560M

# ----------------------
networks:
  internal:
    external: false
    driver: bridge

services:

  db:
    image: mariadb:10.6
    command: --transaction-isolation=READ-COMMITTED --log-bin=binlog --binlog-format=ROW
    volumes:
      - db:/var/lib/mysql
    environment:
      - MYSQL_ROOT_PASSWORD=
      - MYSQL_PASSWORD=
      - MYSQL_DATABASE=nextcloud
      - MYSQL_USER=nextcloud
    <<: *common

  # --- Nextcloud
  nextcloud:
    container_name: nextcloud
    image: nextcloud
    ports:
      - 8080:80
    volumes:
      - nextcloud:/var/www/html
      #- /home/lucasflores/nextcloud:/var/www/html/
      #- /home/lucasflores/nextcloud_data:/var/www/html/data
      #- /nextcloud_data:/var/www/html/data
      #- ./data:/var/www/html/data
    links:
      - db
    environment:
      - MYSQL_PASSWORD=
      - MYSQL_DATABASE=nextcloud
      - MYSQL_USER=nextcloud
      - MYSQL_HOST=db
      #- NEXTCLOUD_DATA_DIR=/var/www/html/data
    <<: *common


  # --- ZeroTier
  zerotier:
      image: zyclonite/zerotier
      container_name: zerotier-one
      devices:
        - /dev/net/tun
      network_mode: host
      volumes:
        - '/var/lib/zerotier-one:/var/lib/zerotier-one'
      cap_add:
        - NET_ADMIN
        - SYS_ADMIN
      restart: unless-stopped


  # --- pihole
  pihole:
    container_name: pihole
    hostname: skynet
    image: pihole/pihole:latest
    # For DHCP it is recommended to remove these ports and instead add: network_mode: "host"
    ports:
      - "53:53/tcp"
      - "53:53/udp"
      # - "67:67/udp" # Only required if you are using Pi-hole as your DHCP server
      - "8081:80/tcp"
    environment:
      TZ: "Europe/Berlin"
      WEBPASSWORD: "password"
      DNSMASQ_LISTENING: all
    # Volumes store your data between container upgrades
    volumes:
      - ./etc-pihole:/etc/pihole
      - ./etc-dnsmasq.d:/etc/dnsmasq.d
    #   https://github.com/pi-hole/docker-pi-hole#note-on-capabilities
    # cap_add:
      # - NET_ADMIN # Required if you are using Pi-hole as your DHCP server, else not needed
    <<: *common

volumes:
  nextcloud:
  db:



```